{"ast":null,"code":"import axios from 'axios';\nimport getConfig from 'next/config';\nconst {\n  publicRuntimeConfig\n} = getConfig();\nconst baseURL = publicRuntimeConfig.BASE_URL || '';\nconst corsBypassURL = publicRuntimeConfig.CORS_BYPASS_URL || '';\nconst API = {\n  get: async (internal, path, params, queries, body) => {\n    try {\n      const url = generateURL(internal, path, params, queries);\n      console.log('url in call ', url); // TODO: use middleware approach to enable CORS\n\n      const response = await axios.get(url); // const response = await axios.get(corsBypassURL + baseURL + path);\n\n      console.log(response);\n      return response.data;\n    } catch (error) {\n      if (error.response) {\n        // The request was made and the server responded with a status code\n        // that falls out of the range of 2xx\n        throw error.response.data;\n        throw error.response.status;\n        throw error.response.headers;\n      } else if (error.request) {\n        // The request was made but no response was received\n        // `error.request` is an instance of XMLHttpRequest in the browser and an instance of\n        // http.ClientRequest in node.js\n        throw error.request;\n      } else {\n        // Something happened in setting up the request that triggered an Error\n        throw error.message;\n      }\n\n      throw error.config;\n    }\n  }\n};\nexport const generateURL = (internal, path, params, queries) => {\n  let finalURL = '';\n\n  if (internal) {\n    finalURL = corsBypassURL + baseURL + path.charAt(0) === '/' ? path : '/' + path;\n  } else {\n    finalURL = path;\n  }\n\n  console.log(internal, finalURL);\n\n  if (params) {\n    const paramKeys = Object.getOwnPropertyNames(params);\n\n    for (const p of paramKeys) {\n      finalURL = finalURL.replace(`:${p}`, params[p]);\n    }\n  }\n\n  if (queries) {\n    const queryKeys = Object.getOwnPropertyNames(queries);\n    const cleanedQueries = queryKeys.filter(k => {\n      return queries[k] !== undefined && queries[k] !== null;\n    });\n\n    if (0 === cleanedQueries.length) {\n      return finalURL;\n    }\n\n    finalURL += '?';\n\n    for (const q of cleanedQueries) {\n      finalURL += `${q}=${queries[q]}&`;\n    }\n  }\n\n  return finalURL.slice(0, -1);\n};\nexport default API;","map":{"version":3,"sources":["/Users/jerald/Desktop/nearby-food-web/src/lib/api/call.ts"],"names":["axios","getConfig","publicRuntimeConfig","baseURL","BASE_URL","corsBypassURL","CORS_BYPASS_URL","API","get","internal","path","params","queries","body","url","generateURL","console","log","response","data","error","status","headers","request","message","config","finalURL","charAt","paramKeys","Object","getOwnPropertyNames","p","replace","queryKeys","cleanedQueries","filter","k","undefined","length","q","slice"],"mappings":"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","sourcesContent":["import axios from 'axios';\nimport getConfig from 'next/config';\n\nconst { publicRuntimeConfig } = getConfig();\nconst baseURL: string = publicRuntimeConfig.BASE_URL || '';\nconst corsBypassURL: string = publicRuntimeConfig.CORS_BYPASS_URL || '';\n\nconst API = {\n  get: async <Response>(internal: boolean, path: string, params?: any, queries?: any, body?: any): Promise<Response | undefined> => {\n    try {\n      const url = generateURL(internal, path, params, queries);\n      console.log('url in call ', url);\n      // TODO: use middleware approach to enable CORS\n      const response = await axios.get(url);\n      // const response = await axios.get(corsBypassURL + baseURL + path);\n      console.log(response);\n      return response.data as Response;\n    } catch (error) {\n      if (error.response) {\n        // The request was made and the server responded with a status code\n        // that falls out of the range of 2xx\n        throw error.response.data;\n        throw error.response.status;\n        throw error.response.headers;\n      } else if (error.request) {\n        // The request was made but no response was received\n        // `error.request` is an instance of XMLHttpRequest in the browser and an instance of\n        // http.ClientRequest in node.js\n        throw error.request;\n      } else {\n        // Something happened in setting up the request that triggered an Error\n        throw error.message;\n      }\n      throw error.config;\n    }\n  }\n};\n\nexport const generateURL = (internal: boolean, path: string, params?: any, queries?: any): string => {\n  let finalURL: string = '';\n  if (internal) {\n    finalURL = corsBypassURL + baseURL + path.charAt(0) === '/' ? path : '/' + path;\n  } else {\n    finalURL = path;\n  }\n  console.log(internal, finalURL);\n  if (params) {\n    const paramKeys = Object.getOwnPropertyNames(params);\n    for (const p of paramKeys) {\n      finalURL = finalURL.replace(`:${p}`, params[p]);\n    }\n  }\n  if (queries) {\n    const queryKeys = Object.getOwnPropertyNames(queries);\n    const cleanedQueries = queryKeys.filter((k: string) => {\n      return queries[k] !== undefined && queries[k] !== null;\n    });\n\n    if (0 === cleanedQueries.length) {\n      return finalURL;\n    }\n\n    finalURL += '?';\n    for (const q of cleanedQueries) {\n      finalURL += `${q}=${queries[q]}&`;\n    }\n  }\n\n  return finalURL.slice(0, -1);\n};\n\nexport default API;\n"]},"metadata":{},"sourceType":"module"}